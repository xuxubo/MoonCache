# ğŸŒ™ MoonCache

**MoonCache** æ˜¯ä¸€ä¸ªçº¯ [MoonBit](https://www.moonbitlang.com/) å®ç°çš„é«˜æ€§èƒ½å†…å­˜ç¼“å­˜åº“ã€‚å®ƒæ”¯æŒå¤šç§ä¸»æµçš„ç¼“å­˜æ·˜æ±°ç­–ç•¥ï¼Œå¹¶æä¾›äº†ä¸€å¥—ç»Ÿä¸€ã€çµæ´»ä¸”æ˜“äºæ‰©å±•çš„ APIï¼Œæ—¨åœ¨æˆä¸º MoonBit ç”Ÿæ€ç³»ç»Ÿä¸­çš„é¦–é€‰ç¼“å­˜è§£å†³æ–¹æ¡ˆã€‚

---

## ğŸš€ ç‰¹æ€§

- ğŸ§© **ä¸°å¯Œçš„ç­–ç•¥æ”¯æŒ**ï¼šå†…ç½®å¤šç§ç¼“å­˜æ·˜æ±°ç®—æ³•ï¼ŒåŒ…æ‹¬ `FIFO`, `LRU`, `LFU`, `ARC`, `LRU-K`, `KHashLRU` å’Œ `HashLFU`ã€‚
- âš™ï¸ **çµæ´»çš„ API è®¾è®¡**ï¼š
    - **ç»Ÿä¸€å·¥å‚æ¨¡å¼**ï¼šé€šè¿‡ `new_cache` å‡½æ•°å’Œ `CachePolicy` æšä¸¾ï¼Œè½»æ¾åˆ›å»ºå’Œåˆ‡æ¢ä¸åŒç­–ç•¥çš„ç¼“å­˜å®ä¾‹ã€‚
    - **ç‹¬ç«‹å®ç°**ï¼šæ¯ç§ç¼“å­˜ç­–ç•¥éƒ½å¯ä»¥ç‹¬ç«‹å¯¼å…¥å’Œä½¿ç”¨ï¼Œæä¾›äº†æœ€å¤§çš„çµæ´»æ€§ã€‚
- ğŸ•’ **å¯é€‰çš„è¿‡æœŸæ—¶é—´ (TTL)**ï¼šä¸ºç¼“å­˜æ¡ç›®è®¾ç½®ç”Ÿå­˜æ—¶é—´ã€‚ï¼ˆè§„åˆ’ä¸­ï¼‰
- ğŸ“Š **ç¼“å­˜æŒ‡æ ‡ç»Ÿè®¡**ï¼šè·å–å‘½ä¸­ç‡ã€æ·˜æ±°æ¬¡æ•°ç­‰å…³é”®æ€§èƒ½æŒ‡æ ‡ã€‚ï¼ˆè§„åˆ’ä¸­ï¼‰
- ğŸ§µ **å¹¶å‘å®‰å…¨**ï¼šä¸ºå¤šçº¿ç¨‹ç¯å¢ƒæä¾›å¼€ç®±å³ç”¨çš„çº¿ç¨‹å®‰å…¨ç¼“å­˜ã€‚ï¼ˆè§„åˆ’ä¸­ï¼‰

---

## ğŸ“¦ å®‰è£…

æ¨èä½¿ç”¨ `moon` å‘½ä»¤è¡Œå·¥å…·ç›´æ¥æ·»åŠ ä¾èµ–(å°šæœªå‘å¸ƒ)ï¼š

```bash
moon add github.com/yourname/mooncache 
```

æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨å…‹éš†æœ¬é¡¹ç›®åˆ°ä½ çš„ `deps` ç›®å½•ä¸‹ï¼š
```bash
git clone https://github.com/yourname/mooncache.git deps/mooncache
```

---

## ğŸ’¡ å¿«é€Ÿå¼€å§‹

æœ‰ä¸¤ç§ä½¿ç”¨ MoonCache çš„æ–¹å¼ï¼š

### 1. ä½¿ç”¨ç»Ÿä¸€å·¥å‚ (æ¨è)

è¿™æ˜¯æœ€ç®€å•ã€æœ€çµæ´»çš„æ–¹å¼ï¼Œæ¨èåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ä½¿ç”¨ã€‚

```moonbit
test {
  // ä½¿ç”¨å·¥å‚åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º 2 çš„ FIFO ç¼“å­˜
  let cache = new_cache(CachePolicy::FIFO, 2)
  
  cache.put("x", 100)
  cache.put("y", 200)
  cache.put("z", 300) // "x" æ˜¯æœ€æ—©æ’å…¥çš„ï¼Œå°†è¢«æ·˜æ±°
  
  assert_eq(cache.get("x"), None)
  assert_eq(cache.get("y"), Some(200))
  assert_eq(cache.get("z"), Some(300))
}
```

### 2. ç›´æ¥ä½¿ç”¨å…·ä½“çš„ç¼“å­˜å®ç°

å¦‚æœä½ æ˜ç¡®çŸ¥é“éœ€è¦å“ªç§ç­–ç•¥ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¯¼å…¥å¹¶ä½¿ç”¨å®ƒã€‚

```moonbit

test {
  
  // åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º 3 çš„ LRU ç¼“å­˜
  let cache : LruCache[String, Int] = LruCache::new(3)

  // æ’å…¥ä¸‰ä¸ªå…ƒç´ 
  cache.put("A", 1)
  cache.put("B", 2)
  cache.put("C", 3)
  println("åˆå§‹ç¼“å­˜çŠ¶æ€ï¼š")
  println(cache.get("A"))
  println(cache.get("B"))
  println(cache.get("C"))

  // è®¿é—® Aï¼Œä½¿å…¶æˆä¸ºæœ€è¿‘ä½¿ç”¨
  let a_val = cache.get("A")
  println(a_val)

  // æ’å…¥æ–°å…ƒç´  Dï¼Œè§¦å‘æ·˜æ±°ï¼ˆåº”æ·˜æ±°æœ€ä¹…æœªè®¿é—®çš„ Bï¼‰
  cache.put("D", 4)
  println("æ’å…¥ D åï¼š")
  println(cache.get("A"))
  println(cache.get("B")) // åº”ä¸º None
  println(cache.get("C"))
  println(cache.get("D"))

  // æ›´æ–° A çš„å€¼å¹¶å†æ¬¡è®¿é—®
  cache.put("A", 10)
  println(cache.get("A"))
}
```

---

## ğŸ—‚ï¸ æ¨¡å—ç»“æ„

```
mooncache/
â”œâ”€â”€ moon.mod           # é¡¹ç›®é…ç½®æ–‡ä»¶
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ fifo.mbt       # FIFO (å…ˆè¿›å…ˆå‡º) ç­–ç•¥å®ç°
â”‚   â”œâ”€â”€ lru.mbt        # LRU (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç­–ç•¥å®ç°
â”‚   â”œâ”€â”€ lfu.mbt        # LFU (æœ€ä¸ç»å¸¸ä½¿ç”¨) ç­–ç•¥å®ç°
â”‚   â”œâ”€â”€ arc.mbt        # ARC (è‡ªé€‚åº”æ›¿æ¢) ç­–ç•¥å®ç°
â”‚   â”œâ”€â”€ cache_hash.mbt    # HashLRU, HashLFU ç­‰åˆ†ç‰‡ç¼“å­˜å®ç°
â”‚   â”œâ”€â”€ lru_k.mbt      # LRU-K ç­–ç•¥å®ç°
â”‚   â””â”€â”€ cache.mbt    # ç»Ÿä¸€ç¼“å­˜å·¥å‚å’Œæ¥å£å®šä¹‰
    
```

---

## ğŸ§ª æµ‹è¯•

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œ MoonBit çš„æµ‹è¯•å‘½ä»¤ï¼š

```bash
moon test
```

æˆ‘ä»¬ä¸ºæ¯ç§ç¼“å­˜ç­–ç•¥å’Œå·¥å‚æ¨¡å¼éƒ½ç¼–å†™äº†è¯¦ç»†çš„å•å…ƒæµ‹è¯•ï¼Œä»¥ç¡®ä¿å…¶è¡Œä¸ºçš„æ­£ç¡®æ€§ã€‚

---

## ğŸ”­ å¼€å‘è·¯çº¿å›¾

| ç‰ˆæœ¬   | æ ¸å¿ƒåŠŸèƒ½                       | çŠ¶æ€      |
| ------ | ------------------------------ | --------- |
| âœ… v0.1 | å®ç° `FIFO`, `LRU`             | âœ”ï¸ å·²å®Œæˆ |
| âœ… v0.2 | å¢åŠ  `LFU`, `LRU-K` æ”¯æŒ       | âœ”ï¸ å·²å®Œæˆ |
| âœ… v0.3 | å®ç° `ARC` å’Œåˆ†ç‰‡ç¼“å­˜          | âœ”ï¸ å·²å®Œæˆ |
| âœ… v0.4 | **ç»Ÿä¸€å·¥å‚æ¨¡å¼**               | âœ”ï¸ å·²å®Œæˆ |
| â³ v0.5 | æ·»åŠ  `TTL` (è¿‡æœŸæ—¶é—´) æ”¯æŒ     | ğŸš§ è¿›è¡Œä¸­ |
| 
| ğŸ’¡ v0.6 | å®ç°ç¼“å­˜æŒ‡æ ‡ç»Ÿè®¡ (`Metrics`)   | ğŸ’¡ è®¡åˆ’ä¸­ |
| ğŸ’¡ v0.7 | å¢åŠ å¹¶å‘å®‰å…¨ç‰ˆæœ¬ (`sync.Cache`)| ğŸ’¡ è®¡åˆ’ä¸­ |
| ğŸš€ v1.0 | å‘å¸ƒåˆ° MoonPkg åŒ…ç®¡ç†å™¨        | ğŸš€ è®¡åˆ’ä¸­ |

---

## ğŸ¤ è´¡çŒ®

æˆ‘ä»¬éå¸¸æ¬¢è¿ä»»ä½•å½¢å¼çš„è´¡çŒ®ï¼æ— è®ºæ˜¯æäº¤ PRã€æŠ¥å‘Š issueï¼Œè¿˜æ˜¯æ”¹è¿›æ–‡æ¡£ï¼Œéƒ½æ˜¯å¯¹é¡¹ç›®çš„å·¨å¤§å¸®åŠ©ã€‚

åœ¨æäº¤ä»£ç å‰ï¼Œè¯·ç¡®ä¿ï¼š
1.  ä»£ç éµå¾ªé¡¹ç›®ç°æœ‰çš„é£æ ¼ã€‚
2.  æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡ (`moon test`)ã€‚

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº [Apache License 2.0](LICENSE) å¼€æºã€‚

---

> â€œA cache beneath the moonlight â€” fast, simple, and adaptive.â€ ğŸŒ™
